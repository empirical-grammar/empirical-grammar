%p#notice= notice

-# TEACHER PAGE
- if current_user.teacher?
  %h2 Welcome #{current_user.name}!
  %p Class code: #{current_user.classcode}
  %p= link_to 'Directory', users_path
  %h3 My Students
  %table.table
    %tr
      %th Students
      - if current_user.assignments
        - current_user.assignments.sort!{|x,y|x.chapter_id <=> y.chapter_id}.each do |assignment|
          %th #{assignment.chapter.title}
    - @roster.each do |student|
      %tr
        %td= student.name
        - current_user.assignments.sort!{|x,y|x.chapter_id <=> y.chapter_id}.each do |assignment|
          - @has_score = false
          - student.scores.each do |score|
            - if score.assignment == assignment
              - @has_score = true
              - if score.items_missed
                %td Quiz: #{score.items_missed}%, Lessons: #{score.lessons_completed}%
              - else
                %td incomplete
          - if !@has_score
            %td


  %p= link_to 'Invite Student', new_user_path
  %h3 My Assignments
  - if current_user.assignments
    %table.table
      %tr
        %th Chapter
        %th Due Date
        %th
        %th
      - current_user.assignments.each do |assignment|
        %tr
          %td #{link_to assignment.chapter.title,chapter_path(assignment.chapter)}
          %td #{assignment.due_date.strftime("%a, %b %d %Y")}
          %td #{link_to 'Change Due Date',edit_assignment_path(assignment)}
          %td #{link_to 'Remove Assignment', assignment, :method => :delete, :data => { :confirm => 'Are you sure?'}}

  %h3= "#{Workbook.first.title} Workbook:"
  %table.table
    %tr
      %th= "Chapter Title"
      %th
      %th
    - Workbook.first.chapters.each do |chapter|
      %tr
        %td #{chapter.title}
        %td #{link_to 'View', chapter}
        %td #{link_to 'Assign', new_assignment_path(:chapter_id => chapter.id, :user_id => current_user.id, :classcode => current_user.classcode)}

-# ADMIN PAGE
- if current_user.admin?
  %table.table
    %tr
      %th= "Admin Console"
    %tr
      %td= link_to 'Chapter Manager', chapters_path
    %tr
      %td= link_to 'Rules Manager', rules_path
    %tr
      %td= link_to 'User Manager', users_path

-# STUDENT PAGE
- if !(current_user.admin?) && !(current_user.teacher?) && current_user
  %h2 Welcome, #{current_user.name}!
  %p Teacher: #{User.where(:classcode => current_user.classcode).where(:role => "teacher").first.name}
  %h3 Current Assignments
  %table.table
    %tr
      %th Assignment
      %th Due Date
      %th Completion Date
      %th Score
    - current_user.scores.each do |score|
      - if score.assignment.due_date.to_i > Time.now.to_i && score.items_missed.nil?
        %tr
          %td= link_to score.assignment.chapter.try(:title), test_path(:chapter_id => score.assignment.chapter.try(:id), :assignment_id => score.assignment.id)
          %td= score.assignment.due_date.strftime("%a, %b %d %Y")
          - if score.completion_date
            %td= score.completion_date.strftime("%a, %b %d %Y")
          - else
            %td
          - if score.items_missed
            %td Quiz: #{score.items_missed}%, Lessons: #{score.lessons_completed}%
          - else
            %td incomplete
  %h3 Past Assignments
  %table.table
    %tr
      %th Assignment
      %th Due Date
      %th Completion Date
      %th Score
    - current_user.scores.each do |score|
      - if Time.now.to_i > score.assignment.due_date.to_i || !score.items_missed.nil?
        %tr
          %td= score.assignment.chapter.title
          %td= score.assignment.due_date.strftime("%a, %b %d %Y")
          - if score.completion_date
            %td= score.completion_date.strftime("%a, %b %d %Y")
          - else
            %td
          - if score.items_missed
            %td Quiz: #{score.items_missed}%, Lessons: #{score.lessons_completed}%
          - else
            %td incomplete