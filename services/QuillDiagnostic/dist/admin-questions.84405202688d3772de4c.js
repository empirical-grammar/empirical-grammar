(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{1314:function(e,t,n){"use strict";n.r(t);var s=n(40),a=n.n(s),o=n(46),i=n.n(o),r=n(56),c=n.n(r),u=n(61),l=n.n(u),h=n(120),p=n.n(h),d=n(62),m=n.n(d),f=n(6),v=n.n(f),g=n(447),b=n(167),y=n(63),k=n.n(y),Q=n(446),w=n(1337),N=n(1412),C=n.n(N),O=n(32),E=n(1333),A=n(166);function K(e){for(var t=(new Date).getTime(),n=0;n<1e7&&!((new Date).getTime()-t>e);n++);}var R=function(e){function n(e){var t;return a()(this,n),(t=c()(this,l()(n).call(this,e))).state={displayNoConceptQuestions:!1,showOnlyArchived:!1,diagnosticQuestions:{}},t.createNew=t.createNew.bind(p()(t)),t.submitNewQuestion=t.submitNewQuestion.bind(p()(t)),t.updateRematchedResponse=t.updateRematchedResponse.bind(p()(t)),t.mapConceptsToList=t.mapConceptsToList.bind(p()(t)),t.responsesWithStatusForQuestion=t.responsesWithStatusForQuestion.bind(p()(t)),t.rematchAllQuestions=t.rematchAllQuestions.bind(p()(t)),t.rematchAllResponses=t.rematchAllResponses.bind(p()(t)),t.rematchResponse=t.rematchResponse.bind(p()(t)),t.renderModal=t.renderModal.bind(p()(t)),t.handleSearchChange=t.handleSearchChange.bind(p()(t)),t.toggleNoConceptQuestions=t.toggleNoConceptQuestions.bind(p()(t)),t.toggleShowArchived=t.toggleShowArchived.bind(p()(t)),t.renderSearchBox=t.renderSearchBox.bind(p()(t)),t}return m()(n,e),i()(n,[{key:"componentWillReceiveProps",value:function(e){var t=e.questions,n=e.lessons;t.hasreceiveddata&&n.hasreceiveddata&&(0!==Object.keys(this.state.diagnosticQuestions).length&&k.a.isEqual(this.props.questions.data,t.data)&&k.a.isEqual(this.props.lessons.data,n.data)||this.setState({diagnosticQuestions:t.data}))}},{key:"createNew",value:function(){this.props.dispatch(b.a.toggleNewQuestionModal())}},{key:"submitNewQuestion",value:function(){var e={name:this.refs.newQuestionName.value};this.props.dispatch(b.a.submitNewQuestion(e)),this.refs.newQuestionName.value=""}},{key:"updateRematchedResponse",value:function(e,t){this.props.dispatch(Object(A.k)(e,t))}},{key:"getErrorsForAttempt",value:function(e){return e.feedback}},{key:"generateFeedbackString",value:function(e){return this.getErrorsForAttempt(e)}},{key:"getMatchingResponse",value:function(e,t,n){var s={questionUID:e.key,responses:k.a.filter(n,function(e){return e.statusCode<2}),focusPoints:e.focusPoints?Object(Q.hashToCollection)(e.focusPoints):[]};return new w.a(s).checkMatch(t.text)}},{key:"mapConceptsToList",value:function(){var e=Object(Q.hashToCollection)(this.props.concepts.data[0]),t=Object(Q.hashToCollection)(this.props.questions.data),n=e.map(function(e){return k.a.where(t,{conceptID:e.uid})});return k.a.flatten(n)}},{key:"responsesWithStatusForQuestion",value:function(e){var t=this.props.responses.data[e];return Object(Q.hashToCollection)(Object(E.a)(t))}},{key:"rematchAllQuestions",value:function(){var n=this,s=["-KP-LIzVyeL6a38yW0im","-KPt1wiz5zY1JgNSLbQZ","-KPt6EDsKbaXVrIf9dJY","-KPt2OD4fkKen27eyiry","-KPt2ZzZAIVsrQ-asGEY","-KP-M1Crf2pvqO4QH6zI","-KP-M7WtUdYK6vd6S57X","-KP-MEpdOxjU7OyzL6ss","-KPt2jWGaZbGEaUKj-da","-KPt2vzVYs2QAWkeo7QT","-KPt3I_hR_Xlv5Cr1mvB","-KP-Mv5jsZKhraQH2DOt","-KPt3fnhAJ_vQF_dD4Oj","-KPt3uD8hulWiYGp3Rm7","-KP-Nc414z5N_TKwnvms","-KP-M1Crf2pvqO4QH6zI-esp","-KP-LIzVyeL6a38yW0im-esp","-KP-M7WtUdYK6vd6S57X-esp","-KPt2OD4fkKen27eyiry-esp","-KP-MEpdOxjU7OyzL6ss-esp","-KPt3I_hR_Xlv5Cr1mvB-esp","-KP-Mv5jsZKhraQH2DOt-esp","-KPt3fnhAJ_vQF_dD4Oj-esp","-KPt3uD8hulWiYGp3Rm7-esp"];k.a.keys(this.props.questions.data).length;k.a.each(Object(Q.hashToCollection)(this.props.questions.data),function(e,t){-1===s.indexOf(e.key)&&e.conceptID&&n.rematchAllResponses(e)})}},{key:"rematchAllResponses",value:function(n){var s=this,a=this.responsesWithStatusForQuestion(n.key),o=k.a.filter(a,function(e){return 1<e.statusCode});o.forEach(function(e,t){o.length;s.rematchResponse(n,e,a)})}},{key:"rematchResponse",value:function(e,t,n){if(t.questionUID&&t.text){var s=this.getMatchingResponse(e,t,n),a=s.response.parentID!==t.parentID||s.response.author!==t.author||s.response.feedback!==t.feedback||s.response.conceptResults!==t.conceptResults,o=!1===s.found;if(a)if(o){var i={weak:!1,text:t.text,count:t.count||1,questionUID:t.questionUID,gradeIndex:"unmatched".concat(t.questionUID)};K(150),this.props.dispatch(Object(A.f)(t.key,i))}else if(void 0===s.response.parentID)this.props.dispatch(Object(A.a)(e.key,t.key));else{var r={weak:!1,parentID:s.response.parentID,author:s.response.author,feedback:s.response.feedback,gradeIndex:"nonhuman".concat(t.questionUID)};s.response.conceptResults&&(r.conceptResults=s.response.conceptResults),K(150),this.updateRematchedResponse(t.key,r)}}}},{key:"renderModal",value:function(){var e=this.props.questions.submittingnew?"is-loading":"";if(this.props.questions.newQuestionModalOpen)return v.a.createElement(Q.Modal,{close:this.createNew},v.a.createElement("div",{className:"box"},v.a.createElement("h4",{className:"title"},"Add New Question"),v.a.createElement("p",{className:"control"},v.a.createElement("label",{className:"label"},"Name"),v.a.createElement("input",{className:"input",placeholder:"Text input",ref:"newQuestionName",type:"text"})),v.a.createElement("p",{className:"control"},v.a.createElement("span",{className:"select"},v.a.createElement("select",null,v.a.createElement("option",null,"Choose a concept"),v.a.createElement("option",null,"And"),v.a.createElement("option",null,"Or")))),v.a.createElement("p",{className:"control"},v.a.createElement("button",{className:"button is-primary ".concat(e),onClick:this.submitNewQuestion},"Submit"))))}},{key:"handleSearchChange",value:function(e){var t=Object(O.push)("/admin/questions/".concat(e.value));this.props.dispatch(t)}},{key:"toggleNoConceptQuestions",value:function(){this.setState({displayNoConceptQuestions:!this.state.displayNoConceptQuestions})}},{key:"toggleShowArchived",value:function(){this.setState({showOnlyArchived:!this.state.showOnlyArchived})}},{key:"renderSearchBox",value:function(){var e=Object(Q.hashToCollection)(this.props.questions.data);if(0<e.length){var t=e.map(function(e){return{name:e.prompt?e.prompt.replace(/(<([^>]+)>)/gi,"").replace(/&nbsp;/gi,""):"No name",value:e.key||"key"}});return v.a.createElement(C.a,{onChange:this.handleSearchChange,options:t,placeholder:"Search for a question"})}}},{key:"render",value:function(){var e=this.props,t=e.questions,n=e.concepts;return t.hasreceiveddata&&n.hasreceiveddata?v.a.createElement("section",{className:"section"},v.a.createElement("div",{className:"container"},v.a.createElement("button",{onClick:this.rematchAllQuestions},"Rematch all Questions"),this.renderModal(),this.renderSearchBox(),v.a.createElement("br",null),v.a.createElement("label",{className:"checkbox"},v.a.createElement("input",{checked:this.state.displayNoConceptQuestions,onClick:this.toggleNoConceptQuestions,type:"checkbox"}),"Display questions with no valid concept"),v.a.createElement(Q.ArchivedButton,{lessons:!1,showOnlyArchived:this.state.showOnlyArchived,toggleShowArchived:this.toggleShowArchived}),v.a.createElement("br",null),v.a.createElement("br",null),v.a.createElement(Q.QuestionListByConcept,{basePath:"questions",concepts:n,displayNoConceptQuestions:this.state.displayNoConceptQuestions,questions:this.state.diagnosticQuestions,showOnlyArchived:this.state.showOnlyArchived}))):v.a.createElement("div",null,"Loading...")}}]),n}(v.a.Component);var P=Object(g.b)(function(e){return{concepts:e.concepts,questions:e.questions,routing:e.routing,lessons:e.lessons}})(R);t.default={path:"questions",indexRoute:{component:P},getChildRoutes:function(e,t){Promise.all([n.e(0),n.e(1),n.e(3),n.e(5),n.e(13)]).then(n.bind(null,1436)).then(function(e){return t(null,e.default)})}}},1333:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return c});var s=n(63),a=n.n(s),o=n(1362),i=n.n(o);function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return a.a.mapObject(e,function(e,t){var n=function(e){var t=0<arguments.length&&void 0!==e?e:{};return t.feedback?t.parent_id?t.optimal?2:3:t.optimal?0:1:4}(e);return Object.assign({},e,{statusCode:n})})}function c(t,e){return e.forEach(function(e){e.levenshtein=new i.a(e.text,t).distance}),e.sort(function(e,t){return e.levenshtein-t.levenshtein!=0?e.levenshtein-t.levenshtein:e.optimal===t.optimal?0:e.optimal?-1:1})}},1362:function(e,t,n){var s;void 0===(s=function(){return function(){function r(e,t){var n,s;for(n=-1,s=e.length;++n<s;)t(e[n],n,e)}function o(e,s){var a;return a=Array(e.length),r(e,function(e,t,n){a[t]=s(e,t,n)}),a}function i(e,s,a){return r(e,function(e,t,n){a=s(e,t,n)}),a}function e(s,a){var o,i,t;return t=this._matrix=[],s==a?this.distance=0:""==s?this.distance=a.length:""==a?this.distance=s.length:(o=[0],r(s,function(e,t){o[++t]=t}),t[0]=o,r(a,function(e,n){i=[++n],r(s,function(e,t){t++,s.charAt(t-1)==a.charAt(n-1)?i[t]=o[t-1]:i[t]=Math.min(o[t]+1,i[t-1]+1,o[t-1]+1)}),o=i,t[t.length]=o}),this.distance=i[i.length-1])}return e.prototype.toString=e.prototype.inspect=function(e){var t,n,s,a;for(n=i(t=this.getMatrix(),function(e,t){return Math.max(e,i(t,Math.max,0))},0),s=Array((n+"").length).join(" "),a=[];a.length<(t[0]&&t[0].length||0);)a[a.length]=Array(s.length+1).join("-");return a=a.join("-+")+"-",o(t,function(e){return o(e,function(e){return(s+e).slice(-s.length)}).join(" |")+" "}).join("\n"+a+"\n")},e.prototype.getMatrix=function(){return this._matrix.slice()},e.prototype.valueOf=function(){return this.distance},e}()}.call(t,n,t,e))||(e.exports=s)}}]);